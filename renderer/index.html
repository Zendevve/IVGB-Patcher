<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';">
  <title>IVGB Patcher+</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="app">
    <div class="titlebar">
      <h1>IVGB Patcher+</h1>
      <span class="subtitle" id="licenseLabel">Free â€” Non-Commercial</span>
      <div class="actions">
        <button class="btn btn-sm" id="btnLicense">ğŸ”‘</button>
        <button class="btn" id="btnOpenFile">ğŸ“‚ Open</button>
        <button class="btn" id="btnOpenMultiple">ğŸ“ Multi</button>
      </div>
    </div>

    <!-- License Modal -->
    <div class="modal-overlay" id="licenseModal">
      <div class="modal">
        <div class="modal-header">
          <h3>ğŸ”‘ License Activation</h3>
          <button class="modal-close" id="licenseModalClose">âœ•</button>
        </div>
        <div class="modal-body">
          <div id="licenseStatusArea"></div>
          <div id="licenseInputArea">
            <label style="color:var(--text-secondary);font-size:0.82rem;display:block;margin-bottom:6px;">
              Enter your license key:
            </label>
            <input type="text" class="license-input" id="licenseKeyInput"
                   placeholder="IVGB-XXXX-XXXX-XXXX-XXXX-XXXX-XXXX-XXXX"
                   spellcheck="false" autocomplete="off">
            <div class="btn-group" style="margin-top:12px;">
              <button class="btn btn-primary" id="btnActivate">Activate</button>
              <button class="btn btn-danger" id="btnDeactivate" style="display:none">Deactivate</button>
            </div>
            <p id="licenseError" style="color:var(--red);font-size:0.82rem;margin-top:8px;display:none"></p>
          </div>
          <div style="margin-top:16px;padding-top:12px;border-top:1px solid var(--border);">
            <a href="#" id="btnBuyLicense" style="color:var(--accent);font-size:0.85rem;text-decoration:none;">
              ğŸ›’ Buy a Pro license â†’
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Drop Zone -->
    <div class="drop-zone" id="dropZone">
      <div class="drop-zone-icon">ğŸ“‚</div>
      <h2>Drop PE files here or click Open</h2>
      <p>.exe Â· .dll Â· .sys Â· .scr Â· .ocx Â· .drv Â· .cpl Â· .efi</p>
    </div>

    <div class="file-list" id="fileList" style="display:none"></div>

    <div id="mainContent" style="display:none">
      <div class="tabs">
        <button class="tab active" data-tab="overview">Overview</button>
        <button class="tab" data-tab="flags">Flags & Patching</button>
        <button class="tab" data-tab="sections">Sections</button>
        <button class="tab" data-tab="imports">Imports</button>
        <button class="tab" data-tab="exports">Exports</button>
        <button class="tab" data-tab="directories">Data Directories</button>
        <button class="tab" data-tab="hexdiff">Hex Diff</button>
        <button class="tab" data-tab="batch">Batch</button>
      </div>

      <div class="tab-content active" id="tab-overview">
        <div class="card">
          <div class="card-header">
            <h3>ğŸ“‹ Summary</h3>
            <div class="btn-group">
              <button class="btn" id="btnSave">ğŸ’¾ Save</button>
              <button class="btn" id="btnSaveAs">ğŸ’¾ Save As</button>
              <button class="btn" id="btnReveal">ğŸ“ Reveal</button>
            </div>
          </div>
          <div class="summary-grid" id="summaryGrid"></div>
        </div>
        <div class="card">
          <div class="card-header"><h3>ğŸ”’ Security Flags</h3></div>
          <div class="summary-grid" id="securityGrid"></div>
        </div>
        <div class="card">
          <div class="card-header"><h3>ğŸ”‘ Hashes</h3></div>
          <div class="summary-grid" id="hashGrid"></div>
        </div>
        <div class="card">
          <div class="card-header"><h3>ğŸ“Š COFF Characteristics</h3></div>
          <div id="coffCharsDisplay"></div>
        </div>
      </div>

      <div class="tab-content" id="tab-flags">
        <div class="card">
          <div class="card-header"><h3>ğŸ›¡ï¸ COFF Characteristics</h3></div>
          <div class="flags-grid" id="coffFlags"></div>
        </div>
        <div class="card">
          <div class="card-header"><h3>ğŸ” DLL Characteristics</h3></div>
          <div class="flags-grid" id="dllFlags"></div>
        </div>
        <div class="card" style="text-align:center;padding:24px;">
          <div class="btn-group" style="justify-content:center;">
            <button class="btn btn-primary" id="btnApply" style="font-size:0.95rem;padding:10px 28px;">ğŸ”§ Apply Changes</button>
            <button class="btn btn-danger" id="btnReset">â†©ï¸ Reset</button>
          </div>
          <p style="color:var(--text-secondary);margin-top:10px;font-size:0.82rem;">PE checksum auto-recalculated.</p>
        </div>
      </div>

      <div class="tab-content" id="tab-sections">
        <div class="card">
          <div class="card-header"><h3>ğŸ“¦ Sections</h3><span id="sectionCount" style="color:var(--text-muted)"></span></div>
          <div class="table-container">
            <table><thead><tr><th>#</th><th>Name</th><th>VSize</th><th>VAddr</th><th>RawSize</th><th>RawOff</th><th>Perms</th><th>Entropy</th><th>Flags</th></tr></thead>
            <tbody id="sectionsBody"></tbody></table>
          </div>
        </div>
      </div>

      <div class="tab-content" id="tab-imports">
        <div class="card">
          <div class="card-header"><h3>ğŸ“¥ Imports</h3><span id="importCount" style="color:var(--text-secondary);font-size:0.82rem;"></span></div>
          <input type="text" class="search-box" id="importSearch" placeholder="Search imports...">
          <div id="importsContainer"></div>
        </div>
      </div>

      <div class="tab-content" id="tab-exports">
        <div class="card">
          <div class="card-header"><h3>ğŸ“¤ Exports</h3><span id="exportCount" style="color:var(--text-secondary);font-size:0.82rem;"></span></div>
          <input type="text" class="search-box" id="exportSearch" placeholder="Search exports...">
          <div id="exportsContainer"></div>
        </div>
      </div>

      <div class="tab-content" id="tab-directories">
        <div class="card">
          <div class="card-header"><h3>ğŸ“ Data Directories</h3></div>
          <div class="table-container">
            <table><thead><tr><th>#</th><th>Name</th><th>RVA</th><th>Size</th><th>Status</th></tr></thead>
            <tbody id="directoriesBody"></tbody></table>
          </div>
        </div>
      </div>

      <div class="tab-content" id="tab-hexdiff">
        <div class="card">
          <div class="card-header"><h3>ğŸ” Changes</h3><span id="diffCount" style="color:var(--text-secondary);font-size:0.82rem;">No changes</span></div>
          <div id="changesContainer"></div>
        </div>
        <div class="card">
          <div class="card-header"><h3>ğŸ“Š Hex Diff</h3></div>
          <div id="hexDiffContainer" class="hex-diff">
            <p style="color:var(--text-muted);text-align:center;padding:30px">Apply changes to see diff.</p>
          </div>
        </div>
      </div>

      <div class="tab-content" id="tab-batch">
        <div class="card">
          <div class="card-header"><h3>ğŸ“ Scan Directory</h3></div>
          <div class="batch-input-group">
            <input type="text" id="batchDir" placeholder="Directory path...">
            <label style="display:flex;align-items:center;gap:5px;color:var(--text-secondary);font-size:0.82rem;white-space:nowrap">
              <input type="checkbox" id="batchRecursive"> Recursive
            </label>
            <button class="btn" id="btnBatchBrowse">ğŸ“</button>
            <button class="btn btn-primary" id="btnBatchScan">ğŸ” Scan</button>
          </div>
          <div id="batchResults"></div>
        </div>
        <div class="card" id="batchPatchCard" style="display:none">
          <div class="card-header"><h3>ğŸ”§ Batch Patch</h3></div>
          <div class="flags-grid" id="batchFlags" style="margin-bottom:12px;"></div>
          <div class="btn-group" style="margin-bottom:12px;">
            <button class="btn" id="btnBSelectAll">Select All</button>
            <button class="btn" id="btnBSelectNone">Select None</button>
            <button class="btn btn-primary" id="btnBatchPatch">ğŸ”§ Patch Selected</button>
          </div>
          <div id="batchFileList" style="max-height:400px;overflow-y:auto;"></div>
          <div id="batchPatchResults"></div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <span>IVGB Patcher+ v2.0.0</span>
      <span id="footerLicense"></span>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content"><div class="spinner"></div><p id="loadingText">Processing...</p></div>
  </div>
  <div class="toast-container" id="toastContainer"></div>

  <script src="js/app.js"></script>
</body>
</html>
